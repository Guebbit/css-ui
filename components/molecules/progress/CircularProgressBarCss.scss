@use "../../../index" as guebbit;

$scss-library-class-prefix: "" !default;
$scss-library-var-prefix: "" !default;
$scss-library-dark-theme-class: "theme--dark" !default;
$scss-library-component-name: "circular-progress-bar-css" !default;

// main
$color: null !default;
$color--light: guebbit.noNullVar(($color, #000)) !default;
$color--dark: guebbit.noNullVar(($color, #fff)) !default;
$active-color: null !default;
$active-color--light: guebbit.noNullVar(($active-color, $color--light)) !default;
$active-color--dark: guebbit.noNullVar(($active-color, $color--dark)) !default;
$background: null !default;
$background--light: guebbit.noNullVar(($background, #fff)) !default;
$background--dark: guebbit.noNullVar(($background, #2B2A33)) !default;

// LIGHT theme
$on-color: guebbit.color-contrast($background--light) !default;
$active-on-color: $on-color !default;

// DARK theme
$on-color--dark: guebbit.color-contrast($background--dark) !default;
$active-on-color--dark: $on-color--dark !default;

// generic
$value: 0 !default;
$duration: 0.5s !default;

@property --#{$scss-library-var-prefix}percentage {
  syntax: '<number>';
  inherits: true;
  initial-value: 0;
}

@keyframes #{$scss-library-class-prefix}#{$scss-library-component-name}-animation {
  0% { --#{$scss-library-var-prefix}percentage: 0; }
  100% { --#{$scss-library-var-prefix}percentage: var(--#{$scss-library-var-prefix}value); }
}

%#{$scss-library-class-prefix}#{$scss-library-component-name},
.#{$scss-library-class-prefix}#{$scss-library-component-name} {
  --#{$scss-library-var-prefix}value: var(--#{$scss-library-var-prefix}#{$scss-library-component-name}-value, #{$value});
  --#{$scss-library-var-prefix}percentage: var(--#{$scss-library-var-prefix}#{$scss-library-component-name}-percentage, #{$percentage});
  --#{$scss-library-var-prefix}duration: var(--#{$scss-library-var-prefix}#{$scss-library-component-name}-duration, #{$duration});
  --#{$scss-library-var-prefix}color: var(--#{$scss-library-var-prefix}#{$scss-library-component-name}-color, #{$color--light});
  --#{$scss-library-var-prefix}active-color: var(--#{$scss-library-var-prefix}#{$scss-library-component-name}-active-color, #{$active-color--light});
  --#{$scss-library-var-prefix}on-color: var(--#{$scss-library-var-prefix}#{$scss-library-component-name}-on-color, #{$on-color});
  --#{$scss-library-var-prefix}background: var(--#{$scss-library-var-prefix}#{$scss-library-component-name}-background, #{$background--light});

  width: 100%;
  animation: #{$scss-library-class-prefix}#{$scss-library-component-name}-animation var(--#{$scss-library-var-prefix}duration) 0.2s forwards;
  aspect-ratio: 1;
  border-radius: 50%;
  position: relative;
  overflow: hidden;
  display: grid;
  place-items: center;
  background-color: var(--#{$scss-library-var-prefix}background);
  color: var(--#{$scss-library-var-prefix}on-color);

  &::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: conic-gradient(var(--#{$scss-library-var-prefix}color) calc(var(--#{$scss-library-var-prefix}percentage) * 1%), var(--#{$scss-library-var-prefix}on-color) 0);
    // stylelint-disable-next-line
    mask-mode: alpha;
    // stylelint-disable-next-line
    mask: radial-gradient(#0000 55%, #000 0);
    -webkit-mask-mode: alpha;
  }

  &::after {
    counter-reset: percentage var(--#{$scss-library-var-prefix}value);
    content: counter(percentage) '%';
    font-family: Helvetica, Arial, sans-serif;
    font-size: 5em;
  }

  &.numberless-mode {
    &::after {
      content: none;
    }
  }

  &.simplified-mode {
    &::before{
      mask: none;
    }
  }

  &.animate-active,
  &.animate-on-active.active,
  &.animate-on-hover:hover {
    background-color: var(--#{$scss-library-var-prefix}active-background);
    color: var(--#{$scss-library-var-prefix}active-on-color);
    &::before {
      background: conic-gradient(var(--#{$scss-library-var-prefix}active-color) calc(var(--#{$scss-library-var-prefix}percentage) * 1%), var(--#{$scss-library-var-prefix}active-on-color) 0);
    }
  }
}

/**
 * Dark Theme (changes from default variables)
 */
@mixin theme-dark-builder(){
  %#{$scss-library-class-prefix}#{$scss-library-component-name},
  .#{$scss-library-class-prefix}#{$scss-library-component-name} {
    --#{$scss-library-var-prefix}color: var(--#{$scss-library-var-prefix}#{$scss-library-component-name}-color, #{$color--dark});
    --#{$scss-library-var-prefix}active-color: var(--#{$scss-library-var-prefix}#{$scss-library-component-name}-active-color, #{$active-color--dark});
    --#{$scss-library-var-prefix}on-color: var(--#{$scss-library-var-prefix}#{$scss-library-component-name}-on-color, #{$on-color--dark});
    --#{$scss-library-var-prefix}background: var(--#{$scss-library-var-prefix}#{$scss-library-component-name}-background, #{$background--dark});
  }
}

/**
 * By class
 */
.#{$scss-library-dark-theme-class}{
  @include theme-dark-builder();
}

/**
 * By browser
 */
@media (prefers-color-scheme: dark) {
  @include theme-dark-builder();
}