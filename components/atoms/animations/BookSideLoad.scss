$scss-library-prefix: "" !default;
$scss-library-component-name: "book-side-load" !default;
$scss-library-var-prefix: "" !default;

$book-side-load-color: #000 !default;
$book-side-load-size: 32px !default;  // WARNING can't change for now
$book-side-load-duration: 7s !default;
$book-side-load-multiplier: 1.8 !default;
$book-side-load-number: 18 !default;

%#{$scss-library-prefix}#{$scss-library-component-name},
.#{$scss-library-prefix}#{$scss-library-component-name}{
  --#{$scss-library-var-prefix}color: #{$book-side-load-color};
  --#{$scss-library-var-prefix}size: #{$book-side-load-size};
  --#{$scss-library-var-prefix}duration: #{$book-side-load-duration};

  font-size: var(--#{$scss-library-var-prefix}size);
  width: 1em;
  height: 12px;
  position: relative;
  margin: 4em 0 0 2em;
  zoom: 1.5;
  box-sizing: border-box;

  * {
    box-sizing: border-box;

    &::before,
    &::after {
      box-sizing: border-box;
    }
  }

  & > .book {
    width: $book-side-load-size;
    height: 12px;
    position: relative;
    transform-origin: 2px 2px;
    transform: rotateZ(-90deg);

    & > * {
      &:nth-child(1),
      &:nth-child(3) {
        width: 1.88em;
        height: 4px;
        top: 0;
        border-radius: 2px;
        background: var(--#{$scss-library-var-prefix}color);
        position: absolute;

        &::before {
          content: '';
          width: 48px;
          height: 4px;
          border-radius: 2px;
          background: inherit;
          position: absolute;
          top: -8px;
          left: 6px;
        }
      }

      &:nth-child(1) {
        right: 28px;
        transform-origin: 58px 2px;
        transform: rotateZ(90deg);
      }

      &:nth-child(2) {
        width: $book-side-load-size;
        height: 12px;
        border: 4px solid var(--#{$scss-library-var-prefix}color);
        border-top: 0;
        border-radius: 0 0 9px 9px;
        transform: translateY(2px);
      }

      &:nth-child(3) {
        left: 28px;
        transform-origin: 2px 2px;
        transform: rotateZ(-90deg);
      }
    }
  }

  .pages {
    margin: 0;
    padding: 0;
    list-style: none;
    position: absolute;
    left: 50%;
    top: 0;

    & > * {
      &:nth-child(1){
        display: none;
      }

      height: 4px;
      border-radius: 2px;
      width: 48px;
      right: 0;
      top: -16px;
      position: absolute;
      background: var(--#{$scss-library-var-prefix}color);
      transform-origin: 100% 2px;
      transform: rotateZ(0deg) translateX(-18px);
      animation-duration: var(--#{$scss-library-var-prefix}duration);
      animation-timing-function: ease;
      animation-iteration-count: infinite;
    }
  }

  &.animate-active{
    .book {
      animation: book-side-load-animation-book var(--#{$scss-library-var-prefix}duration) ease infinite;

      & > * {
        &:nth-child(1) {
          animation: book-side-load-animation-left var(--#{$scss-library-var-prefix}duration) ease infinite;
        }
        &:nth-child(3) {
          animation: book-side-load-animation-right var(--#{$scss-library-var-prefix}duration) ease infinite;
        }
      }
    }

    .pages{
      & > * {
        @for $i from 1 through $book-side-load-number {
          &:nth-child(#{$i + 1}) {
            animation-name: book-side-load-animation-page-#{$i};
          }

          @keyframes book-side-load-animation-page-#{$i} {
            #{4 + ($i * $book-side-load-multiplier)}% {
              transform: rotateZ(0deg) translateX(-18px);
            }
            #{13 + ($i * $book-side-load-multiplier * 0.9)}%,
            #{54 + ($i * $book-side-load-multiplier)}% {
              transform: rotateZ(180deg) translateX(-18px);
            }
            #{63 + ($i * $book-side-load-multiplier * 0.9)}% {
              transform: rotateZ(0deg) translateX(-18px);
            }
          }
        }
      }
    }
  }
}


@keyframes book-side-load-animation-left {
  4% {
    transform: rotateZ(90deg);
  }

  10%,
  40% {
    transform: rotateZ(0deg);
  }

  46%,
  54% {
    transform: rotateZ(90deg);
  }

  60%,
  90% {
    transform: rotateZ(0deg);
  }

  96% {
    transform: rotateZ(90deg);
  }
}


@keyframes book-side-load-animation-right {
  4% {
    transform: rotateZ(-90deg);
  }

  10%,
  40% {
    transform: rotateZ(0deg);
  }

  46%,
  54% {
    transform: rotateZ(-90deg);
  }

  60%,
  90% {
    transform: rotateZ(0deg);
  }

  96% {
    transform: rotateZ(-90deg);
  }
}

@keyframes book-side-load-animation-book {
  4% {
    transform: rotateZ(-90deg);
  }

  10%,
  40% {
    transform: rotateZ(0deg);
    transform-origin: 2px 2px;
  }

  40.01%,
  59.99% {
    transform-origin: 30px 2px;
  }

  46%,
  54% {
    transform: rotateZ(90deg);
  }

  60%,
  90% {
    transform: rotateZ(0deg);
    transform-origin: 2px 2px;
  }

  96% {
    transform: rotateZ(-90deg);
  }
}